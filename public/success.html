<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>âœ… ê²°ì œ ì™„ë£Œ - ì‚°íƒ€ë¥¼ ë§Œë‚œ ìˆœê°„</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Pretendard', -apple-system, sans-serif; background: linear-gradient(135deg, #1a472a, #2d5016); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
    .card { background: white; border-radius: 20px; padding: 40px 30px; max-width: 420px; width: 100%; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
    .icon { font-size: 60px; margin-bottom: 20px; }
    h1 { color: #1a472a; margin-bottom: 10px; font-size: 24px; }
    .order-id { background: #f8f9fa; padding: 10px; border-radius: 8px; font-family: monospace; font-size: 11px; margin: 15px 0; word-break: break-all; color: #666; }
    
    .queue-box { background: linear-gradient(135deg, #e8f5e9, #c8e6c9); padding: 25px; border-radius: 16px; margin: 20px 0; }
    .queue-position { font-size: 48px; font-weight: 800; color: #1a472a; }
    .queue-label { font-size: 14px; color: #666; margin-bottom: 15px; }
    .queue-detail { display: flex; justify-content: space-around; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1); }
    .queue-item { text-align: center; }
    .queue-item .num { font-size: 18px; font-weight: bold; color: #1a472a; }
    .queue-item .label { font-size: 11px; color: #666; }
    
    .estimate-box { background: #fff9c4; padding: 20px; border-radius: 12px; margin: 20px 0; }
    .estimate-time { font-size: 24px; font-weight: bold; color: #c41e3a; }
    .estimate-label { font-size: 13px; color: #666; margin-bottom: 5px; }
    .guarantee { background: #4CAF50; color: white; padding: 8px 16px; border-radius: 20px; display: inline-block; margin-top: 10px; font-size: 13px; font-weight: bold; }
    .guarantee.warning { background: #ff9800; }
    
    .info-box { background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 15px 0; text-align: left; font-size: 14px; }
    .info-box p { margin: 5px 0; color: #555; }
    
    .btn { display: inline-block; background: #1a472a; color: white; padding: 15px 30px; border-radius: 25px; text-decoration: none; margin-top: 15px; }
    .refresh { background: none; border: 1px solid #ddd; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 12px; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="card">
    <div class="icon">ğŸ…âœ…</div>
    <h1>ê²°ì œê°€ ì™„ë£Œë˜ì—ˆì–´ìš”!</h1>
    <p>ì‚°íƒ€ í• ì•„ë²„ì§€ê°€ ì—´ì‹¬íˆ ì¤€ë¹„í•˜ê³  ìˆì–´ìš”</p>
    
    <div class="order-id">ì£¼ë¬¸ë²ˆí˜¸: <span id="orderId">í™•ì¸ ì¤‘...</span></div>
    
    <div class="queue-box">
      <div class="queue-label">í˜„ì¬ ëŒ€ê¸° ìˆœë²ˆ</div>
      <div class="queue-position"><span id="queuePosition">-</span>ë²ˆì§¸</div>
      <div class="queue-detail">
        <div class="queue-item">
          <div class="num" id="totalQueue">-</div>
          <div class="label">ì „ì²´ ëŒ€ê¸°</div>
        </div>
        <div class="queue-item">
          <div class="num" id="avgTime">-ë¶„</div>
          <div class="label">í‰ê·  ì²˜ë¦¬</div>
        </div>
      </div>
    </div>
    
    <div class="estimate-box">
      <div class="estimate-label">ì˜ˆìƒ ì™„ë£Œ ì‹œê°„</div>
      <div class="estimate-time" id="estimateTime">ê³„ì‚° ì¤‘...</div>
      <div class="guarantee" id="guarantee">í™•ì¸ ì¤‘...</div>
    </div>
    
    <div class="info-box">
      <p>ğŸ“© ì™„ì„±ë˜ë©´ ì…ë ¥í•˜ì‹  ì´ë©”ì¼ë¡œ ë‹¤ìš´ë¡œë“œ ë§í¬ë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.</p>
      <p>ğŸ“Œ ìŠ¤íŒ¸í•¨ë„ ê¼­ í™•ì¸í•´ì£¼ì„¸ìš”!</p>
    </div>
    
    <button class="refresh" onclick="loadQueueStatus()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
    
    <p style="color:#666;font-size:12px;margin-top:15px;">ë¬¸ì˜: santa.moment.official@gmail.com</p>
    
    <a href="/" class="btn">ğŸ  í™ˆìœ¼ë¡œ</a>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const orderId = params.get('orderId');
    const paymentKey = params.get('paymentKey');
    const amount = params.get('amount');
    
    document.getElementById('orderId').textContent = orderId || 'í™•ì¸ ë¶ˆê°€';
    
    async function init() {
      if (paymentKey && orderId && amount) {
        try {
          const res = await fetch('/api/payments/confirm', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ paymentKey, orderId, amount: parseInt(amount) })
          });
          const data = await res.json();
          if (data.success) {
            console.log('âœ… ê²°ì œ ìŠ¹ì¸ ì™„ë£Œ');
            setTimeout(loadQueueStatus, 500);
          }
        } catch (e) {
          console.error('ê²°ì œ ìŠ¹ì¸ ì˜¤ë¥˜:', e);
        }
      } else if (orderId) {
        loadQueueStatus();
      }
    }
    
    async function loadQueueStatus() {
      if (!orderId) return;
      
      try {
        const res = await fetch('/api/orders/' + orderId);
        const data = await res.json();
        
        if (data.queue) {
          document.getElementById('queuePosition').textContent = data.queue.position;
          document.getElementById('totalQueue').textContent = data.queue.totalInQueue;
          document.getElementById('avgTime').textContent = data.queue.avgProcessTime + 'ë¶„';
          
          const estTime = new Date(data.queue.estimatedTime);
          const timeStr = estTime.toLocaleString('ko-KR', {
            month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'
          });
          document.getElementById('estimateTime').textContent = timeStr;
          
          const guarantee = document.getElementById('guarantee');
          guarantee.textContent = data.queue.guaranteeText;
          guarantee.className = 'guarantee' + (data.queue.beforeChristmas ? '' : ' warning');
        }
        
        if (data.status === 'completed') {
          document.querySelector('.queue-box').innerHTML = '<div style="font-size:48px;">ğŸ</div><div style="font-size:20px;font-weight:bold;color:#1a472a;margin-top:10px;">ì™„ì„±ë˜ì—ˆì–´ìš”!</div><div style="color:#666;margin-top:5px;">ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”</div>';
          document.querySelector('.estimate-box').style.display = 'none';
        }
      } catch (e) {
        console.error('ëŒ€ê¸°ì—´ ë¡œë“œ ì‹¤íŒ¨:', e);
      }
    }
    
    init();
    setInterval(loadQueueStatus, 30000);
  </script>
</body>
</html>
